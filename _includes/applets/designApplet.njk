{% extends "components/appletShell.njk" %}
{% import "components/button.njk" as "btn"%}
{% set chevronRightIcon %}{% include "icons/chevron-right.svg" %}{% endset %}
{% set externalLinkIcon %}{% include "icons/external-link.svg" %}{% endset %}



{% block content %}
<div
    x-data="{currentFolder: 0, currentItem: null}"
    x-ref="scroller"
    class="flex h-full gap-3 px-3 overflow-auto">
    {# folders #}
    <ul
        x-data="{openDesign: 0}"
        class="flex flex-col gap-1 px-px overflow-auto flex-shrink-0 xs:min-w-[250px]">
            {% for design in designFolders %}
                <li>{{designListItem(title=design.title, date=design.date, index=loop.index, type=design.type, id=design.id, content="folder", class="w-full")}}</li>
            {% endfor %}
        <div @click="openDesign = null; currentFolder = null; currentItem = null; $dispatch('reset-current-item')" class="flex-1 pb-6"></div>
    </ul>
    <div class="mb-3 divider vertical"></div>
    {# subfolders #}
    <ul
        x-cloak
        x-data="{openDesign: 0}"
        @reset-current-item.window="openDesign = null; currentItem = null"
        class="flex flex-col gap-1 px-px overflow-auto flex-shrink-0 xs:min-w-[250px]">
        {% for design in collections.design %}
            <li x-show="currentFolder === '{{design.data.tags[1]}}'">{{designListItem(title=design.data.title, date=design.data.publishDate, index=loop.index, type=design.data.type, id=design.data.title, content="item", class="w-full")}}</li>
        {% endfor %}
        <div @click="openDesign = null; currentItem = null; $dispatch('reset-current-item')" class="flex-1 pb-6"></div>
    </ul>
    <div x-show="currentFolder" class="mb-3 divider vertical"></div>
    {% for design in collections.design %}
    {% set typeIcon %}
        {% if design.data.type === "website" %}{% include "icons/website.svg" %}{% endif %}
        {% if design.data.type === "game" %}{% include "icons/dice.svg" %}{% endif %}
        {% if design.data.type === "plugin" %}{% include "icons/plugin.svg" %}{% endif %}
        {% if design.data.type === "fun" %}{% include "icons/mix.svg" %}{% endif %}
        {% if design.data.type === "work" %}{% include "icons/briefcase.svg" %}{% endif %}
        {% if design.data.type === "volunteer" %}{% include "icons/rocket.svg" %}{% endif %}
    {% endset %}
    <template x-if="currentItem === '{{design.data.title}}'">
        <div class="flex-shrink-0 px-4 overflow-auto flex flex-col items-start gap-6 py-4 w-[300px]">
            <div class="flex flex-col gap-5">
                {# <div class="grid flex-shrink-0 w-10 h-10 transition transform rounded shadow-applet-header place-content-center text-clr-solid bg-clr-tint">
                    <div class="w-5 h-5">{{typeIcon | safe}}</div>
                </div> #}
                <div class="flex flex-col items-start gap-1">
                    <h3 class="text-xl">{{design.data.title}} <span class="capitalize">{{design.data.type}}</span></h3>
                    <p class="text-display-tertiary">{{design.data.excerpt}}</p>
                </div>
            </div>
                {{btn.button(label="View project", icon=externalLinkIcon, as="a", href=design.data.link, newTab=true)}}
            <div class="w-full divider"></div>
            <dl class="grid items-baseline max-w-full text-display-secondary grid-cols-dl gap-x-6 gap-y-4">
                <dt class="text-sm text-display-tertiary">Contribution</dt>
                <dl class="capitalize">{{design.data.contribution}}</dl>
                <dt class="text-sm text-display-tertiary">Date</dt>
                <dl>{{design.data.publishDate}}</dl>
            </dl>
        </div>
    </template>
    {% endfor %}
</div>
{% endblock %}

{% macro designListItem(title, date, class, onClick, type, index, id, content) %}
    {% set icon %}
        {% if type === "website" %}{% include "icons/website.svg" %}{% endif %}
        {% if type === "game" %}{% include "icons/dice.svg" %}{% endif %}
        {% if type === "plugin" %}{% include "icons/plugin.svg" %}{% endif %}
        {% if type === "fun" %}{% include "icons/mix.svg" %}{% endif %}
        {% if type === "work" %}{% include "icons/briefcase.svg" %}{% endif %}
        {% if type === "volunteer" %}{% include "icons/rocket.svg" %}{% endif %}
    {% endset %}

    <button
        @click="
            openDesign = {{index}};
            if ('{{content}}' === 'folder') {
                currentFolder='{{id}}'
                $dispatch('reset-current-item')
            } else {
                currentItem='{{id}}'
            }
            $nextTick(() => { $refs.scroller.scrollTo({ left: 1000 }) })"
        :class="{ 'bg-clr-highlight shadow-list-inset': openDesign === {{index}} }"
        class="{{class}} text-left group block rounded pb-2 pt-1.5 px-2 hover:bg-clr-highlight active:shadow-list-inset">
        <div
            :class="openDesign === {{index}} && 'translate-y-px'"
            class="flex items-center gap-3 transition duration-75 transform group-active:translate-y-px">
            <div
                :class="openDesign === {{index}} ? 'text-clr-solid' : 'text-display-tertiary'"
                class="w-15 h-15">{{icon | safe }}
            </div>
            <div class="flex-1 flex gap-1.5 items-baseline overflow-hidden">
                <p
                    :class="openDesign === {{index}} ? 'text-display-primary' : 'group-active:text-display-primary text-display-secondary'"
                    class="truncate">
                    {{title}}
                </p>
                <time class="block text-sm text-display-tertiary">{{date}}</time>
            </div>
            <div class="w-15 h-15 text-display-tertiary">
                {{chevronRightIcon | safe }}
            </div>
        </div>
    </button>
{% endmacro %}
